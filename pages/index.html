<html>

<head>
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,900" rel="stylesheet">
	<style type="text/css">
		* {
			font-family: 'Roboto', sans-serif;
			color: #fff;
			box-sizing: border-box;
		}

		html,
		body {
			margin: 0;
			padding: 0;
			background-color: #191726;
		}

		.game {
			margin: 0 auto;
		}

		.history-container {
			position: absolute;
			overflow: hidden;
			width: 33%;
			top: 0;
			bottom: 0;
			padding: 0 1em;
		}

		#history {
			padding: 0;
			position: absolute;
			bottom: 0;
			list-style: none;
		}

		.history-entry img.channel {
			display: inline;
			width: 32px;
			vertical-align: middle;
		}

		.history-entry .user {
			font-size: 16pt;
			font-weight: bold;
		}

		.history-entry .command {
			color: rgba(255, 255, 255, 0.75);
		}

		.history-entry .command .emoji {
			font-size: 16pt;
		}

		.history-entry .command .symbol {
			font-size: 24pt;
		}

		#controls {
			position: absolute;
			top: 0;
			right: 17em;
		}

		#controls table {
			text-align: center;
		}

		#controls th {
			padding: 1em;
		}

		#controls tr {
			background-color: #3d2c4e;
		}

		#channels {
			position: absolute;
			top: 0;
			right: 1em;
		}

		#channels div {
			display: flex;
			flex-direction: column;
			padding-bottom: 2em;
		}

		#channels div.oh-yeah {
			padding-bottom: 0;
			flex-direction: row;
			align-items: baseline;
		}

		#channels div.oh-yeah img {
			width: 30px;
			margin-left: 0.5rem;
			border: 0;
		}

		#channels img {
			width: 200px;
			border: 15px solid white;
		}
	</style>
</head>
<div class="history-container">
	<ol id="history"></ol>
</div>
<div class="game" style="width:33%; height:100%;"></div>

<div id="controls">
	<table>
		<thead>
			<tr>
				<th colspan="2">CONTROLS</th>
			</tr>
		</thead>
		<tr>
			<td>Q</td>
			<td>üëà</td>
		</tr>
		<tr>
			<td>W</td>
			<td>üëâ</td>
		</tr>
		<tr>
			<td>A</td>
			<td>‚Ü∫</td>
		</tr>
		<tr>
			<td>S</td>
			<td>‚Üª</td>
		</tr>
		<tr>
			<td>Z</td>
			<td>üëá</td>
		</tr>
	</table>
</div>

<div id="channels">
	<div class="messenger">
		<b>Messenger:</b>
		<img src="https://qr.net/code/X9qmSF.svg" alt="Messenger">
		<a href="https://m.me/193334598203970">@Smooch Plays Tetris</a>
	</div>
	<div class="telegram">
		<b>Telegram:</b>
		<img src="https://qr.net/code/kvPzMm.svg" alt="Telegram">
		<a href="https://web.telegram.org/#/im?p=@SmoochTetrisBot">@SmoochTetrisBot</a>
	</div>
	<div class="viber">
		<div class="oh-yeah">
			<b>Viber:</b>
			<img src="http://cultofthepartyparrot.com/parrots/hd/parrot.gif" alt="oh-yeeaahhh">
		</div>
		<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJEAAACRCAYAAADD2FojAAAEPklEQVR4nO3bQa4bMQwEUd//0skFZgAqRbMppxqYTSCJFPUM/E0+n8/nz5bvKdV1JKSX7vuSnoNfvAERNfUsIhHhnkUkItyziESEe16FaCITiCbwpn4gm95NRCI6iohEhCMiEeGISEQ4CFF1WJseaaLuprl03+PgvD3NkLrViEhEIhq8x8F5e5ohdasRkYhENHiPg/P2NLOpbjW//GM4OG9PM5vqViMiEYlIRCLaMD8Riej3EZFeSF1y324wqXscnLenGTJAEYlIRIfZ9G4iEpGIRJR/tzKi7qSGMJHUD2kiIhqKiESEIyIR4YhIRDgiCn5kWK6LfvEG4sP/lXUiuuCRtq8T0QWPtH2diC54pO3rYt9jhxdmAiqpS/rbnju7foiIcrmz64eIKJc7u36IiHK5s+uHiCiXT/flUgMkYCbuS3omvZCeDz4RiUhEXxlg931Jz6QX0rOIRCSi9AC770t6Jr2QnsvfRNOp80jd7h/DxKwm+hPRQV0RiQjXFZGIcF0RiQjXFdHRH+V7mukeYHcm6qbuQfaK6CAiEhGOiESEIyIR4YhoCBFp+sZebtzb/UMX0aUQJuYnoqFebtwromW93LhXRMt6uXHvCKJqJgZDsunhJu6RiohgfyISEe5PRCLC/YlIRLg/Ef3p/x+w3UOtnkcefaKX7v66e0F1yxMsRkQiwhGRiHBEJCIcEf2HiJY1s2aAExDI3k3rRCQivE5EIsLrRCQivE5EIsLrHhEdbG4dfnc2DXriHqleRBRc132PVC8iCq7rvkeqFxEF13XfI9WLiILruu+R6uXxxImmCbbu/rY/eupHWO6vupAUKTcjIhGd7BVRrj8SEcG6pMam/khEBOuSGpv6I3npp9b0puFP1E3NgPRM7kbqiujlPBHV64ro5TwR1euK6OU8EdXriujlPBHV65Z3k2Ym9k485qZeuoPegxQRkYhEdJhNvXRHRCLCEZGIcGKIyDoSUiMFv/sem84TkYjweSISET5PRCLC54lIRPi8T3VY3cNP1SDnpfZOfNX+XtbteWARiegrg+mukYIwMSsRiUhE3xpMd40UhIlZxRA9/uuifOFXU1pX3Zt6ONJz+31RhwMRkYhwRCQiHBGJCEdEFyDqHkz3UMlgUj1vwjZ0tzweEYlIRF+um5rBwXl5PCISkYi+XDc1g4Pz/v0xSbqHtalG9wOTTJwnoi/UEJGIRHR4noi+UENEIhLR4XllRNULdz/cxLrtiCY+OFMRiUhEeJ2IRITXiUhEeJ2IfhzRRJY9yJq5POXlziISUT0ieomI6hHRS0RUj4heIqJ6fgYRqUvyK2C6fzQiOoiIRIQjIhHhiEhEOCKCiCYuQtZN1E19E3eDMxBRdZ2IRITrikhEuK6IRITriugA0aZhpYa6CcIF88vjWTAEEbH55fEsGIKI2PzyeBYMQURsfnk8C4YgIrD3L44cgIkZeue9AAAAAElFTkSuQmCC"
		 alt="Viber">
		<u>@Smooch Plays Tetris</u>
	</div>
	<div class="line" style="padding-bottom: 0">
		<b>LINE:</b>
		<img style="border: 0" src="https://qr-official.line.me/M/I8OU1gEklT.png" alt="Line">
		<u>@Smooch Plays Tetris</u>
	</div>
</div>
<!-- The stylesheet should go in the <head>, or be included in your CSS -->
<link rel="stylesheet" href="/assets/blockrain.css">

<!-- jQuery and Blockrain.js -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/assets/blockrain.jquery.min.js"></script>

<script>
	var socket = io();

	var colors = [
		'#9acbc6',
		'#807fd5',
		'#e82b7c',
		'#c9e9dc',
		'#a347b7',
		'#fecd00',
		'#8e58b6'
	];

	let started = false;

	$('.game').blockrain({
		autoplay: false, // Let a bot play the game
		autoplayRestart: true, // Restart the game automatically once a bot loses
		showFieldOnStart: true, // Show a bunch of random blocks on the start screen (it looks nice)
		theme: { // The theme name or a theme object
			background: '#191726', // The main background color.
			backgroundGrid: '#101010', // You can draw a small background grid as well.
			primary: null, // Color of the falling blocks. This overrides the standard block color.
			secondary: null, // Color of the placed blocks. This overrides the standard block color.
			stroke: '#191726', // Border color for the blocks.
			innerStroke: 'rgba(0, 0, 0, 0.25)', // A small border inside the blocks to give some texture.

			// The following are the colors of each piece
			blocks: {
				line: colors[0],
				square: colors[1],
				arrow: colors[2],
				rightHook: colors[3],
				leftHook: colors[4],
				rightZag: colors[5],
				leftZag: colors[6]
			}
		},
		blockWidth: 30, // How many blocks wide the field is (The standard is 10 blocks)
		autoBlockWidth: true, // The blockWidth is dinamically calculated based on the autoBlockSize. Disabled blockWidth. Useful for responsive backgrounds
		autoBlockSize: 40, // The max size of a block for autowidth mode
		difficulty: 'normal', // Difficulty (normal|nice|evil).
		speed: 7, // The speed of the game. The higher, the faster the pieces go.

		// Copy
		playText: 'Let\'s play some Tetris with Smooch',
		playButtonText: 'Play',
		gameOverText: 'Game Over',
		restartButtonText: 'Play Again',
		scoreText: 'Score',

		// Basic Callbacks
		onStart: function () {
			started = true;
		},
		onRestart: function () {
			$('#history').empty();
		},
		onGameOver: function (score) {
			started = false;
			socket.emit('gg', score);
		},

		// When a line is made. Returns the number of lines, score assigned and total score
		onLine: function (lines, scoreIncrement, score) { }
	});

	var users = [];

	function log(channel, user, message) {
		var index = users.indexOf(user);
		if (index === -1) {
			users.push(user);
			index = users.length - 1;
		}
		var color = colors[index % colors.length];
		$('#history').append(`
		<li class="history-entry">
		    <img class="channel" src="https://smooch.io/static_assets/images/home/icon-channels/icon-${channel}-gray.svg"/>
			<span class="user" style="color: ${color};">${user || 'ƒÖ…≤‡πè…≤'}</span>
			<span class="command">${message}</span>
		</li>
	`);
	}

	socket.on('restart', function (restart) {
		$('.game').blockrain('restart');
		log(restart.channel, restart.user, 'Restarted the game!');
	});

	socket.on('command', function (command) {
		if (!started) {
			$('.game').blockrain('start');
		}

		function emoji(val) {
			return `<span class="emoji">${val}</span>`;
		}

		function symbol(val) {
			return `<span class="symbol">${val}</span>`;
		}

		var keys = command.keys.map(key => {
			switch (key) {
				case 'left':
					return emoji('üëà');
				case 'right':
					return emoji('üëâ');
				case 'up':
					return emoji('üñï');
				case 'down':
					return emoji('üëé');
				case 'z':
					return symbol('‚Ü∫');
				case 'x':
					return symbol('‚Üª');
				default:
					return key;
			}
		});

		log(command.channel, command.user, keys.join(' '));
	});
</script>

</html>
